<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰é€£æºãƒ†ã‚¹ãƒˆ</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f7fa;
        }
        .test-container {
            background: white;
            padding: 25px;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        .test-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
        }
        .test-button {
            background: #667eea;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 6px;
            cursor: pointer;
            margin: 8px;
            font-size: 14px;
            transition: all 0.3s;
        }
        .test-button:hover {
            background: #5a6fd8;
            transform: translateY(-1px);
        }
        .test-result {
            margin-top: 15px;
            padding: 15px;
            border-radius: 6px;
            font-family: 'Courier New', monospace;
            font-size: 13px;
            white-space: pre-wrap;
            max-height: 300px;
            overflow-y: auto;
        }
        .success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        .info {
            background: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }
        .status-indicator {
            display: inline-block;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 8px;
        }
        .status-ok { background-color: #28a745; }
        .status-error { background-color: #dc3545; }
        .status-warning { background-color: #ffc107; }
    </style>
</head>
<body>
    <div class="test-header">
        <h1>ğŸ§ª ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ãƒ»ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰é€£æºãƒ†ã‚¹ãƒˆ</h1>
        <p>å ã„ãƒãƒ£ãƒƒãƒˆã‚·ã‚¹ãƒ†ãƒ ã®APIé€£æºã¨OpenAIçµ±åˆæ©Ÿèƒ½ã‚’ãƒ†ã‚¹ãƒˆã—ã¾ã™</p>
    </div>

    <div class="test-container">
        <h2>ğŸ“¡ APIæ¥ç¶šãƒ†ã‚¹ãƒˆ</h2>
        <button class="test-button" onclick="testHealthCheck()">ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯</button>
        <button class="test-button" onclick="testChatAPI()">ãƒãƒ£ãƒƒãƒˆAPI</button>
        <button class="test-button" onclick="testFortuneAPI()">å ã„API</button>
        <button class="test-button" onclick="testLogAPI()">ãƒ­ã‚°API</button>
        <div id="apiTestResult" class="test-result info"></div>
    </div>

    <div class="test-container">
        <h2>ğŸ¤– OpenAIçµ±åˆãƒ†ã‚¹ãƒˆ</h2>
        <button class="test-button" onclick="testOpenAIChat()">OpenAIå¿œç­”ãƒ†ã‚¹ãƒˆ</button>
        <button class="test-button" onclick="testCharacterConsistency()">ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ä¸€è²«æ€§ãƒ†ã‚¹ãƒˆ</button>
        <button class="test-button" onclick="testAnalysisFeatures()">åˆ†ææ©Ÿèƒ½ãƒ†ã‚¹ãƒˆ</button>
        <div id="openaiTestResult" class="test-result info"></div>
    </div>

    <div class="test-container">
        <h2>ğŸ”„ ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ãƒ†ã‚¹ãƒˆ</h2>
        <button class="test-button" onclick="testInvalidRequests()">ç„¡åŠ¹ãƒªã‚¯ã‚¨ã‚¹ãƒˆãƒ†ã‚¹ãƒˆ</button>
        <button class="test-button" onclick="testNetworkErrors()">ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚¨ãƒ©ãƒ¼ãƒ†ã‚¹ãƒˆ</button>
        <button class="test-button" onclick="testFallbackResponses()">ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯å¿œç­”ãƒ†ã‚¹ãƒˆ</button>
        <div id="errorTestResult" class="test-result info"></div>
    </div>

    <div class="test-container">
        <h2>ğŸ“Š ç·åˆãƒ†ã‚¹ãƒˆçµæœ</h2>
        <div id="overallResult" class="test-result info">
            ãƒ†ã‚¹ãƒˆã‚’å®Ÿè¡Œã—ã¦ãã ã•ã„...
        </div>
    </div>

    <script>
        let testResults = {
            healthCheck: false,
            chatAPI: false,
            fortuneAPI: false,
            logAPI: false,
            openaiChat: false,
            characterConsistency: false,
            analysisFeatures: false,
            errorHandling: false
        };

        // ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯ãƒ†ã‚¹ãƒˆ
        async function testHealthCheck() {
            const resultDiv = document.getElementById('apiTestResult');
            resultDiv.className = 'test-result info';
            resultDiv.textContent = 'ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯å®Ÿè¡Œä¸­...';

            try {
                const response = await fetch('http://127.0.0.1:8011/', {
                    method: 'GET'
                });

                if (response.ok) {
                    const data = await response.json();
                    resultDiv.className = 'test-result success';
                    resultDiv.textContent = `âœ… ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯æˆåŠŸ\nå¿œç­”: ${JSON.stringify(data, null, 2)}`;
                    testResults.healthCheck = true;
                } else {
                    throw new Error(`HTTP ${response.status}`);
                }
            } catch (error) {
                resultDiv.className = 'test-result error';
                resultDiv.textContent = `âŒ ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯å¤±æ•—: ${error.message}`;
                testResults.healthCheck = false;
            }
            updateOverallResult();
        }

        // ãƒãƒ£ãƒƒãƒˆAPIãƒ†ã‚¹ãƒˆ
        async function testChatAPI() {
            const resultDiv = document.getElementById('apiTestResult');
            resultDiv.className = 'test-result info';
            resultDiv.textContent = 'ãƒãƒ£ãƒƒãƒˆAPIå®Ÿè¡Œä¸­...';

            try {
                const response = await fetch('http://127.0.0.1:8011/api/chat', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        message: 'ã“ã‚“ã«ã¡ã¯ã€ãƒ†ã‚¹ãƒˆãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã§ã™',
                        user_data: {},
                        chat_history: [],
                        rally_count: 1
                    })
                });

                if (response.ok) {
                    const data = await response.json();
                    resultDiv.className = 'test-result success';
                    resultDiv.textContent = `âœ… ãƒãƒ£ãƒƒãƒˆAPIæˆåŠŸ\nå¿œç­”: "${data.response}"\nã‚«ãƒ†ã‚´ãƒª: ${data.category}\nã‚¹ã‚³ã‚¢: ${data.fortune_timing_score}`;
                    testResults.chatAPI = true;
                } else {
                    throw new Error(`HTTP ${response.status}`);
                }
            } catch (error) {
                resultDiv.className = 'test-result error';
                resultDiv.textContent = `âŒ ãƒãƒ£ãƒƒãƒˆAPIå¤±æ•—: ${error.message}`;
                testResults.chatAPI = false;
            }
            updateOverallResult();
        }

        // å ã„APIãƒ†ã‚¹ãƒˆ
        async function testFortuneAPI() {
            const resultDiv = document.getElementById('apiTestResult');
            resultDiv.className = 'test-result info';
            resultDiv.textContent = 'å ã„APIå®Ÿè¡Œä¸­...';

            try {
                const response = await fetch('http://127.0.0.1:8011/api/fortune', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        fortune_type: 'ç·åˆé‹å‹¢ãƒ»äººç”ŸæŒ‡é‡',
                        user_data: { test: true },
                        specific_context: 'ãƒ†ã‚¹ãƒˆç”¨ã®å ã„å®Ÿè¡Œã§ã™'
                    })
                });

                if (response.ok) {
                    const data = await response.json();
                    resultDiv.className = 'test-result success';
                    resultDiv.textContent = `âœ… å ã„APIæˆåŠŸ\nå ã„çµæœ: "${data.fortune_result.substring(0, 200)}..."`;
                    testResults.fortuneAPI = true;
                } else {
                    throw new Error(`HTTP ${response.status}`);
                }
            } catch (error) {
                resultDiv.className = 'test-result error';
                resultDiv.textContent = `âŒ å ã„APIå¤±æ•—: ${error.message}`;
                testResults.fortuneAPI = false;
            }
            updateOverallResult();
        }

        // ãƒ­ã‚°APIãƒ†ã‚¹ãƒˆ
        async function testLogAPI() {
            const resultDiv = document.getElementById('apiTestResult');
            resultDiv.className = 'test-result info';
            resultDiv.textContent = 'ãƒ­ã‚°APIå®Ÿè¡Œä¸­...';

            try {
                const response = await fetch('http://127.0.0.1:8011/api/log', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        timestamp: new Date().toISOString(),
                        type: 'integration_test',
                        data: { message: 'ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰é€£æºãƒ†ã‚¹ãƒˆ' },
                        sessionId: 'test_session_' + Date.now()
                    })
                });

                if (response.ok) {
                    const data = await response.json();
                    resultDiv.className = 'test-result success';
                    resultDiv.textContent = `âœ… ãƒ­ã‚°APIæˆåŠŸ\nå¿œç­”: ${JSON.stringify(data, null, 2)}`;
                    testResults.logAPI = true;
                } else {
                    throw new Error(`HTTP ${response.status}`);
                }
            } catch (error) {
                resultDiv.className = 'test-result error';
                resultDiv.textContent = `âŒ ãƒ­ã‚°APIå¤±æ•—: ${error.message}`;
                testResults.logAPI = false;
            }
            updateOverallResult();
        }

        // OpenAIå¿œç­”ãƒ†ã‚¹ãƒˆ
        async function testOpenAIChat() {
            const resultDiv = document.getElementById('openaiTestResult');
            resultDiv.className = 'test-result info';
            resultDiv.textContent = 'OpenAIçµ±åˆãƒ†ã‚¹ãƒˆå®Ÿè¡Œä¸­...';

            try {
                const response = await fetch('http://127.0.0.1:8011/api/chat', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        message: 'æœ€è¿‘æ‹æ„›ã§æ‚©ã‚“ã§ã„ã¾ã™ã€‚ç›¸æ‰‹ã®æ°—æŒã¡ãŒã‚ˆãã‚ã‹ã‚‰ãªãã¦ä¸å®‰ã§ã™ã€‚',
                        user_data: {},
                        chat_history: [],
                        rally_count: 1
                    })
                });

                if (response.ok) {
                    const data = await response.json();
                    const responseLength = data.response.length;
                    const hasEmpathy = data.response.includes('æ°—æŒã¡') || data.response.includes('ä¸å®‰') || data.response.includes('æ‚©ã¿');

                    resultDiv.className = 'test-result success';
                    resultDiv.textContent = `âœ… OpenAIå¿œç­”ãƒ†ã‚¹ãƒˆæˆåŠŸ\n` +
                        `å¿œç­”é•·: ${responseLength}æ–‡å­—\n` +
                        `å…±æ„Ÿçš„è¡¨ç¾: ${hasEmpathy ? 'å«ã¾ã‚Œã‚‹' : 'å«ã¾ã‚Œãªã„'}\n` +
                        `ã‚«ãƒ†ã‚´ãƒª: ${data.category}\n` +
                        `å¿œç­”å†…å®¹: "${data.response.substring(0, 150)}..."`;
                    testResults.openaiChat = true;
                } else {
                    throw new Error(`HTTP ${response.status}`);
                }
            } catch (error) {
                resultDiv.className = 'test-result error';
                resultDiv.textContent = `âŒ OpenAIå¿œç­”ãƒ†ã‚¹ãƒˆå¤±æ•—: ${error.message}`;
                testResults.openaiChat = false;
            }
            updateOverallResult();
        }

        // ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ä¸€è²«æ€§ãƒ†ã‚¹ãƒˆ
        async function testCharacterConsistency() {
            const resultDiv = document.getElementById('openaiTestResult');
            resultDiv.className = 'test-result info';
            resultDiv.textContent = 'ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ä¸€è²«æ€§ãƒ†ã‚¹ãƒˆå®Ÿè¡Œä¸­...';

            try {
                const messages = [
                    'ã‚ãªãŸã¯èª°ã§ã™ã‹ï¼Ÿ',
                    'éœŠèƒ½åŠ›ã«ã¤ã„ã¦æ•™ãˆã¦ãã ã•ã„',
                    'å ã„ã‚’ãŠé¡˜ã„ã—ã¾ã™'
                ];

                const responses = [];

                for (const message of messages) {
                    const response = await fetch('http://127.0.0.1:8011/api/chat', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({
                            message: message,
                            user_data: {},
                            chat_history: [],
                            rally_count: 1
                        })
                    });

                    if (response.ok) {
                        const data = await response.json();
                        responses.push(data.response);
                    }
                }

                const hasSouji = responses.some(r => r.includes('è’¼å¸'));
                const hasSpiritual = responses.some(r => r.includes('éœŠèƒ½') || r.includes('å ã„') || r.includes('éœŠè¦–'));
                const hasPolite = responses.every(r => r.includes('ã§ã™') || r.includes('ã¾ã™'));

                resultDiv.className = 'test-result success';
                resultDiv.textContent = `âœ… ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ä¸€è²«æ€§ãƒ†ã‚¹ãƒˆçµæœ\n` +
                    `åå‰è¨€åŠ: ${hasSouji ? 'âœ…' : 'âŒ'}\n` +
                    `éœŠèƒ½è¦ç´ : ${hasSpiritual ? 'âœ…' : 'âŒ'}\n` +
                    `æ•¬èªä½¿ç”¨: ${hasPolite ? 'âœ…' : 'âŒ'}\n` +
                    `å¿œç­”æ•°: ${responses.length}/3`;
                testResults.characterConsistency = true;

            } catch (error) {
                resultDiv.className = 'test-result error';
                resultDiv.textContent = `âŒ ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ä¸€è²«æ€§ãƒ†ã‚¹ãƒˆå¤±æ•—: ${error.message}`;
                testResults.characterConsistency = false;
            }
            updateOverallResult();
        }

        // åˆ†ææ©Ÿèƒ½ãƒ†ã‚¹ãƒˆ
        async function testAnalysisFeatures() {
            const resultDiv = document.getElementById('openaiTestResult');
            resultDiv.className = 'test-result info';
            resultDiv.textContent = 'åˆ†ææ©Ÿèƒ½ãƒ†ã‚¹ãƒˆå®Ÿè¡Œä¸­...';

            try {
                const response = await fetch('http://127.0.0.1:8011/api/chat', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        message: 'ç–²ã‚ŒãŸã€‚ã‚‚ã†ã ã‚ã ã€‚é ‘å¼µã£ãŸã®ã«èªã‚ã¦ã‚‚ã‚‰ãˆãªã„ã€‚å¯‚ã—ã„ã€‚',
                        user_data: {},
                        chat_history: [],
                        rally_count: 3
                    })
                });

                if (response.ok) {
                    const data = await response.json();

                    const hasNeedsAnalysis = Object.values(data.needs_analysis || {}).some(v => v > 0);
                    const hasEmotionAnalysis = data.emotion_analysis && data.emotion_analysis.dominant_emotion;
                    const hasResortScores = data.resort_scores && Object.keys(data.resort_scores).length > 0;

                    resultDiv.className = 'test-result success';
                    resultDiv.textContent = `âœ… åˆ†ææ©Ÿèƒ½ãƒ†ã‚¹ãƒˆæˆåŠŸ\n` +
                        `ãƒ‹ãƒ¼ã‚ºåˆ†æ: ${hasNeedsAnalysis ? 'å‹•ä½œ' : 'æœªå‹•ä½œ'}\n` +
                        `æ„Ÿæƒ…åˆ†æ: ${hasEmotionAnalysis ? 'å‹•ä½œ' : 'æœªå‹•ä½œ'}\n` +
                        `RESORTåˆ†æ: ${hasResortScores ? 'å‹•ä½œ' : 'æœªå‹•ä½œ'}\n` +
                        `å ã„ã‚¿ã‚¤ãƒŸãƒ³ã‚°: ${data.fortune_timing_score || 0}ç‚¹\n` +
                        `ä¸»è¦æ„Ÿæƒ…: ${data.emotion_analysis?.dominant_emotion || 'N/A'}`;
                    testResults.analysisFeatures = true;
                } else {
                    throw new Error(`HTTP ${response.status}`);
                }
            } catch (error) {
                resultDiv.className = 'test-result error';
                resultDiv.textContent = `âŒ åˆ†ææ©Ÿèƒ½ãƒ†ã‚¹ãƒˆå¤±æ•—: ${error.message}`;
                testResults.analysisFeatures = false;
            }
            updateOverallResult();
        }

        // ç„¡åŠ¹ãƒªã‚¯ã‚¨ã‚¹ãƒˆãƒ†ã‚¹ãƒˆ
        async function testInvalidRequests() {
            const resultDiv = document.getElementById('errorTestResult');
            resultDiv.className = 'test-result info';
            resultDiv.textContent = 'ç„¡åŠ¹ãƒªã‚¯ã‚¨ã‚¹ãƒˆãƒ†ã‚¹ãƒˆå®Ÿè¡Œä¸­...';

            try {
                const response = await fetch('http://127.0.0.1:8011/api/chat', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        invalid_field: 'invalid_value'
                    })
                });

                if (response.status === 422 || response.status === 400) {
                    resultDiv.className = 'test-result success';
                    resultDiv.textContent = `âœ… ç„¡åŠ¹ãƒªã‚¯ã‚¨ã‚¹ãƒˆãƒ†ã‚¹ãƒˆæˆåŠŸ\né©åˆ‡ã«ã‚¨ãƒ©ãƒ¼ãƒ¬ã‚¹ãƒãƒ³ã‚¹ (${response.status}) ã‚’è¿”ã—ã¾ã—ãŸ`;
                    testResults.errorHandling = true;
                } else if (response.ok) {
                    resultDiv.className = 'test-result success';
                    resultDiv.textContent = `âš ï¸ ç„¡åŠ¹ãƒªã‚¯ã‚¨ã‚¹ãƒˆãƒ†ã‚¹ãƒˆéƒ¨åˆ†æˆåŠŸ\nã‚µãƒ¼ãƒãƒ¼ãŒãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯å‡¦ç†ã‚’å®Ÿè¡Œã—ã¾ã—ãŸ`;
                    testResults.errorHandling = true;
                } else {
                    throw new Error(`äºˆæœŸã—ãªã„ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹: ${response.status}`);
                }
            } catch (error) {
                resultDiv.className = 'test-result error';
                resultDiv.textContent = `âŒ ç„¡åŠ¹ãƒªã‚¯ã‚¨ã‚¹ãƒˆãƒ†ã‚¹ãƒˆå¤±æ•—: ${error.message}`;
                testResults.errorHandling = false;
            }
            updateOverallResult();
        }

        // ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚¨ãƒ©ãƒ¼ãƒ†ã‚¹ãƒˆï¼ˆå­˜åœ¨ã—ãªã„ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆï¼‰
        async function testNetworkErrors() {
            const resultDiv = document.getElementById('errorTestResult');
            resultDiv.className = 'test-result info';
            resultDiv.textContent = 'ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚¨ãƒ©ãƒ¼ãƒ†ã‚¹ãƒˆå®Ÿè¡Œä¸­...';

            try {
                const response = await fetch('http://127.0.0.1:8011/api/nonexistent', {
                    method: 'GET'
                });

                if (response.status === 404) {
                    resultDiv.className = 'test-result success';
                    resultDiv.textContent = `âœ… ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚¨ãƒ©ãƒ¼ãƒ†ã‚¹ãƒˆæˆåŠŸ\né©åˆ‡ã«404ã‚¨ãƒ©ãƒ¼ã‚’è¿”ã—ã¾ã—ãŸ`;
                    testResults.errorHandling = testResults.errorHandling && true;
                } else {
                    throw new Error(`äºˆæœŸã—ãªã„ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹: ${response.status}`);
                }
            } catch (error) {
                if (error.name === 'TypeError' && error.message.includes('Failed to fetch')) {
                    resultDiv.className = 'test-result success';
                    resultDiv.textContent = `âœ… ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚¨ãƒ©ãƒ¼ãƒ†ã‚¹ãƒˆæˆåŠŸ\né©åˆ‡ã«ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚¨ãƒ©ãƒ¼ã‚’ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã—ã¾ã—ãŸ`;
                } else {
                    resultDiv.className = 'test-result error';
                    resultDiv.textContent = `âŒ ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚¨ãƒ©ãƒ¼ãƒ†ã‚¹ãƒˆå¤±æ•—: ${error.message}`;
                    testResults.errorHandling = false;
                }
            }
            updateOverallResult();
        }

        // ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯å¿œç­”ãƒ†ã‚¹ãƒˆ
        async function testFallbackResponses() {
            const resultDiv = document.getElementById('errorTestResult');
            resultDiv.className = 'test-result info';
            resultDiv.textContent = 'ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯å¿œç­”ãƒ†ã‚¹ãƒˆå®Ÿè¡Œä¸­...';

            // ä¸€æ™‚çš„ã«OpenAI APIã‚’ç„¡åŠ¹ãªè¨­å®šã«ã—ã¦ãƒ†ã‚¹ãƒˆã™ã‚‹ã“ã¨ã¯ã§ããªã„ãŸã‚ã€
            // æ­£å¸¸ãªå¿œç­”ãŒè¿”ã£ã¦ãã‚‹ã“ã¨ã‚’ç¢ºèª
            try {
                const response = await fetch('http://127.0.0.1:8011/api/chat', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        message: 'ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ãƒ†ã‚¹ãƒˆ',
                        user_data: {},
                        chat_history: [],
                        rally_count: 1
                    })
                });

                if (response.ok) {
                    const data = await response.json();
                    resultDiv.className = 'test-result success';
                    resultDiv.textContent = `âœ… ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯å¿œç­”ãƒ†ã‚¹ãƒˆæˆåŠŸ\n` +
                        `ã‚·ã‚¹ãƒ†ãƒ ãŒæ­£å¸¸ã«å¿œç­”ã‚’è¿”ã—ã¾ã—ãŸ\n` +
                        `å¿œç­”: "${data.response.substring(0, 100)}..."`;
                    testResults.errorHandling = testResults.errorHandling && true;
                } else {
                    throw new Error(`HTTP ${response.status}`);
                }
            } catch (error) {
                resultDiv.className = 'test-result error';
                resultDiv.textContent = `âŒ ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯å¿œç­”ãƒ†ã‚¹ãƒˆå¤±æ•—: ${error.message}`;
                testResults.errorHandling = false;
            }
            updateOverallResult();
        }

        // ç·åˆçµæœæ›´æ–°
        function updateOverallResult() {
            const resultDiv = document.getElementById('overallResult');
            const passed = Object.values(testResults).filter(Boolean).length;
            const total = Object.keys(testResults).length;
            const successRate = (passed / total * 100).toFixed(1);

            let resultText = `ğŸ“Š ç·åˆãƒ†ã‚¹ãƒˆçµæœ: ${passed}/${total} åˆæ ¼ (${successRate}%)\n\n`;

            // å€‹åˆ¥çµæœ
            const testNames = {
                healthCheck: 'ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯',
                chatAPI: 'ãƒãƒ£ãƒƒãƒˆAPI',
                fortuneAPI: 'å ã„API',
                logAPI: 'ãƒ­ã‚°API',
                openaiChat: 'OpenAIå¿œç­”',
                characterConsistency: 'ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ä¸€è²«æ€§',
                analysisFeatures: 'åˆ†ææ©Ÿèƒ½',
                errorHandling: 'ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°'
            };

            for (const [key, name] of Object.entries(testNames)) {
                const status = testResults[key] ? 'âœ…' : 'âŒ';
                const indicator = testResults[key] ? 'status-ok' : 'status-error';
                resultText += `${status} ${name}\n`;
            }

            // ç·åˆè©•ä¾¡
            resultText += '\n';
            if (successRate >= 90) {
                resultText += 'ğŸ‰ ç·åˆè©•ä¾¡: å„ªç§€ - ã‚·ã‚¹ãƒ†ãƒ ã¯æ­£å¸¸ã«å‹•ä½œã—ã¦ã„ã¾ã™';
                resultDiv.className = 'test-result success';
            } else if (successRate >= 70) {
                resultText += 'âœ… ç·åˆè©•ä¾¡: è‰¯å¥½ - ä¸€éƒ¨æ©Ÿèƒ½ã«æ”¹å–„ã®ä½™åœ°ãŒã‚ã‚Šã¾ã™';
                resultDiv.className = 'test-result success';
            } else {
                resultText += 'âš ï¸ ç·åˆè©•ä¾¡: è¦æ”¹å–„ - é‡è¦ãªå•é¡ŒãŒæ¤œå‡ºã•ã‚Œã¾ã—ãŸ';
                resultDiv.className = 'test-result error';
            }

            resultDiv.textContent = resultText;
        }

        // åˆæœŸåŒ–
        window.addEventListener('load', () => {
            console.log('ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰é€£æºãƒ†ã‚¹ãƒˆãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿å®Œäº†');
            updateOverallResult();
        });
    </script>
</body>
</html>