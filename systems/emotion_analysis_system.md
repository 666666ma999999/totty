# Claude Sonnet 4 感情解析システム（ハイブリッド型）

## システム概要
多層感情解析により、表面・中層・深層の感情を段階的に理解し、適切な共感レベルと文体調整を実現する。

## 基本データ構造
```json
{
  "primary_emotion": "主要感情の特定",
  "emotion_intensity": 0-100,
  "emotion_layers": {
    "surface": "今、表に出ている気持ち",
    "middle": "心の中で揺れている感情",
    "deep": "本当に大切にしたい想い"
  },
  "empathy_level": 1-5,
  "tone_matching": "相談者の文体に合わせた調整",
  "analysis_quality": "primary/enhanced"
}
```

## 主要感情カテゴリ定義

### ポジティブ感情
- **喜び**: 「嬉しい」「楽しい」「幸せ」「最高」
- **安心**: 「ホッとした」「安心」「落ち着いた」「大丈夫」
- **感謝**: 「ありがとう」「感謝」「助かった」「嬉しい」
- **期待**: 「楽しみ」「ワクワク」「期待」「希望」
- **愛情**: 「好き」「愛してる」「大切」「愛おしい」

### ネガティブ感情
- **不安**: 「不安」「心配」「怖い」「緊張」「ドキドキ」
- **悲しみ**: 「悲しい」「辛い」「苦しい」「泣きたい」「沈んでる」
- **怒り**: 「腹が立つ」「イライラ」「ムカつく」「許せない」
- **絶望**: 「もうダメ」「疲れた」「やる気ない」「消えたい」
- **孤独**: 「寂しい」「一人」「誰もわかってくれない」「孤独」
- **嫉妬**: 「羨ましい」「ずるい」「妬ましい」「悔しい」
- **恥**: 「恥ずかしい」「情けない」「みっともない」「穴があったら」

### 複雑感情
- **迷い**: 「わからない」「どうしよう」「迷ってる」「決められない」
- **混乱**: 「混乱」「パニック」「頭が回らない」「整理できない」
- **諦め**: 「諦めた」「しょうがない」「無理」「どうでもいい」

## 感情強度計算ルール

### 強度判定キーワード
```yaml
intensity_modifiers:
  very_high: ["すごく", "とても", "めちゃくちゃ", "本当に", "死ぬほど"]
  high: ["かなり", "相当", "結構", "だいぶ"]
  medium: ["ちょっと", "少し", "やや", "まあまあ"]
  low: ["微妙に", "なんとなく", "若干"]
```

### 基本スコア算出
- **基礎点**: 感情キーワード検出時 = 40点
- **強度修飾語**: very_high(+30), high(+20), medium(+10), low(+5)
- **繰り返し**: 同一感情の重複 = +15点/回
- **感嘆符**: 「！」の数 × 5点
- **継続表現**: 「ずっと」「いつも」 = +10点

## 多層感情解析システム

### 表層感情（Surface Layer）
**検出対象**: 直接的な感情表現
**判定方法**: キーワードマッチング + 文脈解析
**例**:
- 「イライラする」→ 表層：怒り
- 「嬉しい」→ 表層：喜び

### 中層感情（Middle Layer）
**検出対象**: 感情の背景・原因
**判定方法**: 文脈分析 + 推論
**パターン**:
```yaml
middle_layer_patterns:
  anxiety_behind_anger:
    surface: "怒り"
    middle: "不安・恐れ"
    triggers: ["関係性への不安", "コントロール欲求"]

  sadness_behind_anger:
    surface: "怒り"
    middle: "悲しみ・失望"
    triggers: ["期待の裏切り", "愛情の欲求不満"]

  fear_behind_excitement:
    surface: "期待・興奮"
    middle: "不安・恐れ"
    triggers: ["変化への不安", "失敗への恐れ"]
```

### 深層感情（Deep Layer）
**検出対象**: 根本的な心理的ニーズ
**判定方法**: パターン認識 + 心理学的洞察
**基本ニーズ分類**:
```yaml
deep_needs:
  love_and_acceptance:
    keywords: ["愛されたい", "認められたい", "受け入れられたい"]
    manifestations: ["承認欲求", "関係性への執着", "拒絶への恐れ"]

  security_and_stability:
    keywords: ["安心したい", "安定", "守られたい"]
    manifestations: ["変化への抵抗", "予測可能性の追求"]

  autonomy_and_control:
    keywords: ["自分らしく", "コントロール", "自由"]
    manifestations: ["支配されることへの嫌悪", "選択権の主張"]

  self_worth_and_significance:
    keywords: ["価値", "意味", "存在意義"]
    manifestations: ["自己否定", "完璧主義", "比較癖"]
```

## 共感レベル判定システム

### レベル1（基礎共感）: 感情の認識
- **条件**: 基本的な感情キーワード検出
- **応答**: 「〜なんですね」「大変でしたね」

### レベル2（感情共感）: 感情の共有
- **条件**: 感情強度30-50
- **応答**: 「その気持ち、よくわかります」

### レベル3（状況共感）: 状況理解
- **条件**: 感情強度50-70、文脈理解
- **応答**: 「そんな状況だったら、誰でもそう感じますよね」

### レベル4（深層共感）: 深い理解
- **条件**: 感情強度70-85、中層感情検出
- **応答**: 「本当は〜という気持ちもあるのかもしれませんね」

### レベル5（統合共感）: 全人格的理解
- **条件**: 感情強度85+、深層感情検出
- **応答**: 「〜という想いを大切にしているあなたの気持ち、心から理解できます」

## トーンマッチング調整

### 文体解析パターン
```yaml
tone_patterns:
  casual_young:
    indicators: ["やばい", "マジで", "めっちゃ", "〜だわ"]
    response_tone: "親しみやすく、同世代的"

  polite_formal:
    indicators: ["〜です", "〜ます", "恐れ入りますが"]
    response_tone: "丁寧で落ち着いた"

  emotional_unstable:
    indicators: ["！！！", "。。。", "もう", "どうして"]
    response_tone: "優しく安定した"

  analytical:
    indicators: ["思うに", "考えてみると", "〜だと思います"]
    response_tone: "理知的で構造化された"
```

## 緊急時検出システム

### 危機レベル判定
```yaml
crisis_levels:
  level_5_emergency:
    keywords: ["死にたい", "消えたい", "いなくなりたい", "終わりにしたい"]
    action: "専門機関への案内優先"
    analysis_mode: "enhanced"

  level_4_high_risk:
    keywords: ["もうダメ", "限界", "耐えられない", "壊れそう"]
    action: "深い共感モード、専門的サポート提案"

  level_3_moderate:
    keywords: ["疲れた", "辛すぎる", "苦しい"]
    action: "感情安定化優先"
```

## システムプロンプトテンプレート

### 基本テンプレート
```
あなたは心の専門家パートナーとして、以下の感情分析結果に基づいて応答してください。

【感情分析結果】
- 主要感情: {primary_emotion}
- 感情強度: {emotion_intensity}/100
- 表層感情: {surface_emotion}
- 中層感情: {middle_emotion}
- 深層感情: {deep_emotion}
- 共感レベル: {empathy_level}/5
- 推奨トーン: {tone_matching}

【応答指示】
1. 検出された感情に対して適切な共感レベルで応答
2. 表層だけでなく中層・深層の感情も考慮
3. 推奨トーンで自然な返答
4. 3センテンス以内、温かく支援的な態度
```

## パラメータ調整

### 調整可能要素
```yaml
adjustable_parameters:
  emotion_detection_threshold: 0.3
  intensity_calculation_weights:
    base_score: 40
    modifier_bonus: [5, 10, 20, 30]
    repetition_bonus: 15
    exclamation_bonus: 5

  empathy_level_thresholds: [30, 50, 70, 85]
  crisis_detection_sensitivity: 0.8
  tone_matching_confidence: 0.7
```