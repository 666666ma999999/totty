<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>占いチャットシステム - 蒼司の占い館</title>
    <link rel="stylesheet" href="/static/styles.css">
</head>
<body>
    <div class="container">
        <!-- メインチャットエリア -->
        <div class="main-chat">
            <div class="chat-header">
                <h1>🔮 蒼司の占い館</h1>
                <p class="character-intro">心の専門家パートナー 蒼司があなたの心に寄り添い、一緒に答えを見つけていきます</p>
                <div class="header-links">
                    <a href="/chat_history/" class="history-link">📋 チャット履歴を見る</a>
                </div>
            </div>
            
            <div class="chat-messages" id="chatMessages">
                <div class="message bot-message">
                    <div class="message-content">
                        <p>挨拶文を読み込み中...</p>
                    </div>
                </div>
            </div>
            
            <div class="chat-input-area">
                <div class="input-container">
                    <textarea id="userInput" placeholder="悩みや想いを自由にお話しください..." rows="3"></textarea>
                    <button id="sendButton" type="button">送信</button>
                </div>
            </div>
            
            <!-- 占い提案エリア -->
            <div class="fortune-suggestions" id="fortuneSuggestions" style="display: none;">
                <h3>✨ あなたにおすすめの占い</h3>
                <div class="suggestions-container" id="suggestionsContainer">
                    <!-- 動的に生成される占い提案 -->
                </div>
            </div>
        </div>
        
        <!-- サイドバー（リアルタイム表示） -->
        <div class="sidebar">
            <h2>📊 リアルタイム分析</h2>
            
            <!-- ラリー回数 -->
            <div class="analysis-section">
                <h3>💬 ラリー回数</h3>
                <div class="value-display">
                    <span id="rallyCount">0</span> 回
                </div>
            </div>
            
            <!-- リソース値 -->
            <div class="analysis-section">
                <h3>💪 心理的リソース</h3>
                <div class="progress-bar">
                    <div class="progress-fill" id="iValueBar" style="width: 0%"></div>
                </div>
                <div class="value-display">
                    <span id="iValue">0</span> / 10
                </div>
            </div>
            
            <!-- データ収集状況 -->
            <div class="analysis-section">
                <h3>📋 データ収集</h3>
                <div class="data-collection">
                    <div class="data-item">
                        <span>基本情報</span>
                        <span id="basicInfoProgress">0%</span>
                    </div>
                    <div class="data-item">
                        <span>心理・感情</span>
                        <span id="emotionProgress">0%</span>
                    </div>
                    <div class="data-item">
                        <span>恋愛関係</span>
                        <span id="loveProgress">0%</span>
                    </div>
                    <div class="data-item">
                        <span>仕事・キャリア</span>
                        <span id="careerProgress">0%</span>
                    </div>
                    <div class="data-item">
                        <span>スピリチュアル</span>
                        <span id="spiritualProgress">0%</span>
                    </div>
                    <div class="data-total">
                        <strong>総合: <span id="totalDataProgress">0%</span></strong>
                    </div>
                </div>
            </div>
            
            <!-- 検出ニーズ -->
            <div class="analysis-section">
                <h3>❤️ 検出ニーズ</h3>
                <div class="needs-display">
                    <div class="need-item">
                        <span>愚痴・傾聴</span>
                        <div class="need-bar">
                            <div class="need-fill" id="complaintBar"></div>
                        </div>
                        <span id="complaintScore">0%</span>
                    </div>
                    <div class="need-item">
                        <span>感情整理</span>
                        <div class="need-bar">
                            <div class="need-fill" id="emotionOrgBar"></div>
                        </div>
                        <span id="emotionOrgScore">0%</span>
                    </div>
                    <div class="need-item">
                        <span>承認欲求</span>
                        <div class="need-bar">
                            <div class="need-fill" id="recognitionBar"></div>
                        </div>
                        <span id="recognitionScore">0%</span>
                    </div>
                    <div class="need-item">
                        <span>励まし</span>
                        <div class="need-bar">
                            <div class="need-fill" id="encouragementBar"></div>
                        </div>
                        <span id="encouragementScore">0%</span>
                    </div>
                    <div class="need-item">
                        <span>孤独感</span>
                        <div class="need-bar">
                            <div class="need-fill" id="lonelinessBar"></div>
                        </div>
                        <span id="lonelinessScore">0%</span>
                    </div>
                </div>
            </div>
            
            <!-- キャラクター情報 -->
            <div class="analysis-section">
                <h3>👤 キャラクター</h3>
                <div class="character-info">
                    <div class="character-name">蒼司 (Souji)</div>
                    <div class="character-role">心の専門家パートナー</div>
                    <div class="character-mood" id="characterMood">穏やか</div>
                </div>
            </div>
            
            <!-- RESORT値 -->
            <div class="analysis-section">
                <h3>🌟 RESORT 6次元分析</h3>
                <div class="resort-display">
                    <div class="resort-item">
                        <span>R (関係性)</span>
                        <span id="relationshipScore">0</span>
                    </div>
                    <div class="resort-item">
                        <span>E (感情強度)</span>
                        <span id="emotionScore">0</span>
                    </div>
                    <div class="resort-item">
                        <span>S (状況深刻度)</span>
                        <span id="situationScore">0</span>
                    </div>
                    <div class="resort-item">
                        <span>O (目的明確性)</span>
                        <span id="objectiveScore">0</span>
                    </div>
                    <div class="resort-item">
                        <span>R (心理リソース)</span>
                        <span id="resourceScore">0</span>
                    </div>
                    <div class="resort-item">
                        <span>T (時間的要因)</span>
                        <span id="timeScore">0</span>
                    </div>
                    <div class="resort-total">
                        <strong>総合: <span id="resortTotal">0</span></strong>
                    </div>
                </div>

                <!-- 分析詳細表示 -->
                <div class="resort-analysis-details" id="resortAnalysisDetails" style="margin-top: 15px; display: none;">
                    <h4 style="margin-bottom: 10px; color: #4a5568; font-size: 0.9em;">分析詳細:</h4>
                    <div class="analysis-details-content" style="font-size: 0.8em; line-height: 1.4; color: #666;">
                        <div id="relationshipDetail" class="detail-item"></div>
                        <div id="emotionDetail" class="detail-item"></div>
                        <div id="situationDetail" class="detail-item"></div>
                        <div id="objectiveDetail" class="detail-item"></div>
                        <div id="resourceDetail" class="detail-item"></div>
                        <div id="timeDetail" class="detail-item"></div>
                    </div>
                </div>
            </div>
            
            <!-- 感情分析値 -->
            <div class="analysis-section">
                <h3>😊 感情分析値</h3>
                <div class="emotion-analysis">
                    <div class="emotion-item">
                        <span>主要感情</span>
                        <span id="primaryEmotion">-</span>
                    </div>
                    <div class="emotion-item">
                        <span>強度</span>
                        <span id="emotionIntensityNew">0/100</span>
                    </div>
                    <div class="emotion-item">
                        <span>共感レベル</span>
                        <span id="empathyLevel">1/5</span>
                    </div>
                    <div class="emotion-item">
                        <span>解析品質</span>
                        <span id="analysisQuality">-</span>
                    </div>
                </div>
            </div>

            <!-- 多層感情分析 -->
            <div class="analysis-section">
                <h3>🧠 多層感情解析</h3>
                <div class="emotion-layers">
                    <div class="layer-item">
                        <span class="layer-label">表層</span>
                        <span id="surfaceEmotion">-</span>
                    </div>
                    <div class="layer-item">
                        <span class="layer-label">中層</span>
                        <span id="middleEmotion">-</span>
                    </div>
                    <div class="layer-item">
                        <span class="layer-label">深層</span>
                        <span id="deepEmotion">-</span>
                    </div>
                </div>
            </div>

            <!-- トーンマッチング -->
            <div class="analysis-section">
                <h3>🎭 トーンマッチング</h3>
                <div class="tone-info">
                    <div class="tone-item">
                        <span>推奨トーン</span>
                        <span id="toneMatching">-</span>
                    </div>
                    <div class="tone-item">
                        <span>危機レベル</span>
                        <span id="crisisLevel">0</span>
                    </div>
                </div>
            </div>
            
            <!-- 占い提案タイミング -->
            <div class="analysis-section">
                <h3>🎯 占い提案スコア</h3>
                <div class="timing-score">
                    <div class="score-display">
                        <span id="fortuneTimingScore">0</span> / 100
                    </div>
                    <div class="progress-bar">
                        <div class="progress-fill fortune-timing" id="fortuneTimingBar"></div>
                    </div>
                    <div class="timing-status" id="timingStatus">準備中</div>
                </div>
            </div>
            
            <!-- 第三文カテゴリ -->
            <div class="analysis-section">
                <h3>💭 第3文カテゴリ</h3>
                <div class="category-info">
                    <div class="current-category">
                        <span>選択カテゴリ:</span>
                        <span id="selectedCategory">-</span>
                    </div>
                    <div class="category-score">
                        <span>適合度:</span>
                        <span id="categoryScore">-</span>
                    </div>
                    <div class="category-algorithm">
                        <span>判定方式:</span>
                        <span id="algorithmType">ニーズベース</span>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- 占い結果モーダル -->
    <div class="modal" id="fortuneModal">
        <div class="modal-content">
            <span class="close" id="closeModal">&times;</span>
            <div class="fortune-result" id="fortuneResult">
                <!-- 占い結果が動的に挿入される -->
            </div>
        </div>
    </div>
    
    <!-- ログ管理パネル -->
    <div class="log-controls" id="logControls">
        <div class="log-buttons">
            <button id="downloadLogsBtn" class="log-btn">📥 ログダウンロード</button>
            <button id="clearLogsBtn" class="log-btn">🗑️ ログクリア</button>
            <button id="toggleLogViewBtn" class="log-btn">👁️ ログ表示切替</button>
        </div>
        <div class="log-status" id="logStatus">
            <span>ログ件数: <span id="logCount">0</span></span>
            <span>セッションID: <span id="sessionId">-</span></span>
        </div>
    </div>
    
    <!-- ログビューアー -->
    <div class="log-viewer" id="logViewer" style="display: none;">
        <div class="log-viewer-header">
            <h3>📋 ログビューアー</h3>
            <button id="closeLogViewer" class="close-btn">×</button>
        </div>
        <div class="log-viewer-content" id="logViewerContent">
            <!-- ログ内容がここに表示される -->
        </div>
    </div>
    
    <script src="/static/app.js?v=20250916-fix-v2"></script>
</body>
</html>